# ==============================================================================
# KEYCLOAK ENVIRONMENT VARIABLES
# ==============================================================================

# ------------------------------------------------------------------------------
# Database Configuration
# ------------------------------------------------------------------------------
POSTGRES_DB=keycloak
POSTGRES_USER=keycloak
POSTGRES_PASSWORD=keycloak_password_change_this
POSTGRES_ROOT_PASSWORD=postgres_root_password_change_this

# Database connection details
KC_DB=postgres
KC_DB_URL=jdbc:postgresql://keycloak-db:5432/keycloak
KC_DB_USERNAME=keycloak
KC_DB_PASSWORD=keycloak_password_change_this
KC_DB_SCHEMA=public

# ------------------------------------------------------------------------------
# Keycloak Admin Configuration
# ------------------------------------------------------------------------------
KEYCLOAK_ADMIN=admin
KEYCLOAK_ADMIN_PASSWORD=admin_password_change_this

# ------------------------------------------------------------------------------
# Hostname and Network Configuration
# ------------------------------------------------------------------------------
# For development (localhost)
KC_HOSTNAME=localhost
KC_HOSTNAME_PORT=8080
KC_HOSTNAME_STRICT=false
KC_HOSTNAME_STRICT_HTTPS=false

# For production (uncomment and modify)
# KC_HOSTNAME=auth.yourdomain.com
# KC_HOSTNAME_PORT=443
# KC_HOSTNAME_STRICT=true
# KC_HOSTNAME_STRICT_HTTPS=true

# Proxy configuration (edge, reencrypt, passthrough)
KC_PROXY=edge

# ------------------------------------------------------------------------------
# HTTP/HTTPS Configuration
# ------------------------------------------------------------------------------
KC_HTTP_ENABLED=true
KC_HTTP_PORT=8080
KC_HTTPS_PORT=8443

# For production (HTTPS only)
# KC_HTTP_ENABLED=false

# ------------------------------------------------------------------------------
# Security and SSL Configuration
# ------------------------------------------------------------------------------
# SSL/TLS settings for production
# KC_HTTPS_CERTIFICATE_FILE=/opt/keycloak/conf/server.crt.pem
# KC_HTTPS_CERTIFICATE_KEY_FILE=/opt/keycloak/conf/server.key.pem
# KC_HTTPS_TRUST_STORE_FILE=/opt/keycloak/conf/truststore.p12
# KC_HTTPS_TRUST_STORE_PASSWORD=password

# ------------------------------------------------------------------------------
# Health and Monitoring
# ------------------------------------------------------------------------------
KC_HEALTH_ENABLED=true
KC_METRICS_ENABLED=true

# ------------------------------------------------------------------------------
# Logging Configuration
# ------------------------------------------------------------------------------
KC_LOG_LEVEL=INFO
KC_LOG_CONSOLE_COLOR=true
KC_LOG_CONSOLE_FORMAT="%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c] (%t) %s%e%n"

# Log to file (optional)
# KC_LOG_FILE=/opt/keycloak/logs/keycloak.log
# KC_LOG_FILE_FORMAT="%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c] (%t) %s%e%n"

# ------------------------------------------------------------------------------
# Performance and Caching
# ------------------------------------------------------------------------------
KC_CACHE=ispn
KC_CACHE_STACK=tcp

# Cache configuration file (optional)
# KC_CACHE_CONFIG_FILE=cache-ispn.xml

# ------------------------------------------------------------------------------
# Features Configuration
# ------------------------------------------------------------------------------
# Enable/disable Keycloak features
KC_FEATURES=token-exchange,admin-fine-grained-authz,declarative-user-profile

# Available features:
# - account2: New Account Management Console
# - account-api: Account Management REST API
# - admin-fine-grained-authz: Fine-grained authorization in Admin Console
# - admin2: New Admin Console
# - authorization: Authorization Services
# - ciba: Client Initiated Backchannel Authentication
# - client-policies: Client Policies
# - client-secret-rotation: Client Secret Rotation
# - declarative-user-profile: Declarative User Profile
# - docker: Docker Registry Protocol
# - dynamic-scopes: Dynamic OAuth 2.0 scopes
# - fips: FIPS 140-2 mode
# - impersonation: User Impersonation
# - js-adapter: JavaScript Adapter
# - kerberos: Kerberos/SPNEGO SSO
# - linkedin-oauth: LinkedIn Social Identity Provider
# - map-storage: New Store
# - par: Pushed Authorization Requests (PAR)
# - persistent-user-sessions: Persistent User Sessions
# - preview: All preview features
# - recovery-codes: Recovery codes
# - scripts: JavaScript-based authenticators and policies
# - step-up-authentication: Step-up Authentication
# - token-exchange: Token Exchange Service
# - update-email: Update Email Action
# - web-authn: W3C Web Authentication (WebAuthn)

# ------------------------------------------------------------------------------
# Database Pool Configuration
# ------------------------------------------------------------------------------
# KC_DB_POOL_INITIAL_SIZE=5
# KC_DB_POOL_MIN_SIZE=5
# KC_DB_POOL_MAX_SIZE=20

# ------------------------------------------------------------------------------
# JVM Configuration
# ------------------------------------------------------------------------------
# Java options for performance tuning
JAVA_OPTS=-Xms512m -Xmx2g -XX:MetaspaceSize=96M -XX:MaxMetaspaceSize=256m -Djava.net.preferIPv4Stack=true

# Garbage Collection tuning (optional)
# JAVA_OPTS_APPEND=-XX:+UseG1GC -XX:MaxGCPauseMillis=100

# ------------------------------------------------------------------------------
# Clustering Configuration (for multiple instances)
# ------------------------------------------------------------------------------
# KC_CACHE_STACK=tcp
# JGROUPS_DISCOVERY_PROTOCOL=JDBC_PING
# JGROUPS_DISCOVERY_PROPERTIES=datasource_jndi_name=java:jboss/datasources/KeycloakDS

# ------------------------------------------------------------------------------
# Email Configuration (SMTP)
# ------------------------------------------------------------------------------
# Configure these in Keycloak Admin Console > Realm Settings > Email
# Or set via environment variables (advanced):
# KC_SPI_EMAIL_TEMPLATE_PROVIDER=freemarker
# KC_SPI_EMAIL_TEMPLATE_FREEMARKER_ENABLED=true

# ------------------------------------------------------------------------------
# User Federation (LDAP/Active Directory)
# ------------------------------------------------------------------------------
# Configure in Admin Console > User Federation
# Or programmatically via Admin REST API

# ------------------------------------------------------------------------------
# Social Identity Providers
# ------------------------------------------------------------------------------
# Configure in Admin Console > Identity Providers
# Example environment variables for Google:
# GOOGLE_CLIENT_ID=your-google-client-id
# GOOGLE_CLIENT_SECRET=your-google-client-secret

# ------------------------------------------------------------------------------
# Custom Providers and Themes
# ------------------------------------------------------------------------------
# Path to custom providers (JARs)
# KC_SPI_CONNECTIONS_JPA_LEGACY_MIGRATION_STRATEGY=manual

# Custom theme name
# KC_SPI_THEME_DEFAULT=custom-theme

# ------------------------------------------------------------------------------
# Development/Debug Configuration
# ------------------------------------------------------------------------------
# Enable debug mode (not for production)
# KC_LOG_LEVEL=DEBUG
# KC_LOG_CONSOLE_OUTPUT=json

# Enable development mode (auto-reload, etc.)
# KC_DEVELOPMENT_MODE=true

# ------------------------------------------------------------------------------
# Backup Configuration
# ------------------------------------------------------------------------------
# PostgreSQL backup settings
POSTGRES_BACKUP_DIR=/backups
POSTGRES_BACKUP_RETENTION_DAYS=30

# ------------------------------------------------------------------------------
# Monitoring and Alerting
# ------------------------------------------------------------------------------
# Health check intervals
HEALTHCHECK_INTERVAL=30s
HEALTHCHECK_TIMEOUT=10s
HEALTHCHECK_RETRIES=5
HEALTHCHECK_START_PERIOD=120s

# ------------------------------------------------------------------------------
# Container Configuration
# ------------------------------------------------------------------------------
# Container restart policy
RESTART_POLICY=unless-stopped

# Network configuration
NETWORK_NAME=keycloak-network

# Volume configuration
DB_VOLUME_NAME=keycloak-db-data
KEYCLOAK_VOLUME_NAME=keycloak-data

# ------------------------------------------------------------------------------
# Traefik Integration
# ------------------------------------------------------------------------------
# Domain for Traefik routing
TRAEFIK_DOMAIN=auth.localhost

# For production with HTTPS
# TRAEFIK_DOMAIN=auth.yourdomain.com
# TRAEFIK_CERTRESOLVER=letsencrypt

# ------------------------------------------------------------------------------
# IMPORTANT SECURITY NOTES
# ------------------------------------------------------------------------------
# 1. Change ALL default passwords before production use
# 2. Use strong, unique passwords (minimum 16 characters)
# 3. Enable HTTPS in production (set KC_HTTP_ENABLED=false)
# 4. Configure proper hostname and certificates
# 5. Regularly update Keycloak and PostgreSQL images
# 6. Monitor logs and set up alerting
# 7. Implement proper backup and disaster recovery
# 8. Review and harden security settings regularly
# 9. Use secrets management in production (not .env files)
# 10. Enable audit logging for compliance

# ==============================================================================
# END OF CONFIGURATION
# ==============================================================================
